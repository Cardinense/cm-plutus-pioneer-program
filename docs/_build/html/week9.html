

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>10. Week 09 - Marlowe &mdash; Plutus Pioneer Program Lecture Notes  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="9. Week 08 - Property Based Testing" href="week8.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Plutus Pioneer Program Lecture Notes
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="week1.html">2. Week 01 - Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week2.html">3. Week 02 - Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week3.html">4. Week 03 - Script Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="week4.html">5. Week 04 - Monads</a></li>
<li class="toctree-l1"><a class="reference internal" href="week5.html">6. Week 05 - Native Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="week6.html">7. Week 06 - Oracles</a></li>
<li class="toctree-l1"><a class="reference internal" href="week7.html">8. Week 07 - State Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="week8.html">9. Week 08 - Property Based Testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. Week 09 - Marlowe</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">10.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lecture-by-prof-simon-thomson">10.2. Lecture by Prof. Simon Thomson</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-do-we-build-dsls">10.2.1. Why do we build DSLs?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-kind-of-assurance-can-we-give">10.2.2. What kind of assurance can we give?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-does-a-financial-contract-do">10.2.3. What does a financial contract do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#language-design">10.2.4. Language design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#designed-for-safety">10.2.4.1. Designed for safety</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-marlowe-language">10.2.5. The Marlowe Language</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-marlowe-product">10.2.6. The Marlowe Product</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Plutus Pioneer Program Lecture Notes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">10. </span>Week 09 - Marlowe</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/week9.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="week-09-marlowe">
<h1><span class="section-number">10. </span>Week 09 - Marlowe<a class="headerlink" href="#week-09-marlowe" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a written version of <a class="reference external" href="https://youtu.be/-RpCqHuxfQQ">Lecture
#9</a>.</p>
<p>In this lecture we cover Marlowe - a special-purpose language for financial contracts on Cardano.</p>
</div>
<div class="section" id="overview">
<h2><span class="section-number">10.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In the previous lectures we have learnt about all the important ingredients for writing a Plutus application.</p>
<p>We have first looked at the extended UTxO model - the accounting model that Cardano uses - and the additions that Plutus brings to it.</p>
<p>Then we have talked about on-chain validation, minting policies, writing off-chain code, we have seen how to deploy smart contracts and also how to test them.</p>
<p>Plutus is a very powerful language. So powerful, in fact, that you can implement other languages on top of it - you can write an interpreter in Plutus for other languages.</p>
<p>One such language is Marlowe. Marlowe is a Domain Specific Language (DSL) for smart contracts.</p>
<p>For this lecture, Professor Simon Thomson, a very prominent figure in the Haskell community who leads the Marlowe team, and his colleague Alex Nemish will give guest lectures to tell us a bit about Marlowe.</p>
<p>Afterwards we will look at the Marlowe playground and play with a simple smart contract.</p>
</div>
<div class="section" id="lecture-by-prof-simon-thomson">
<h2><span class="section-number">10.2. </span>Lecture by Prof. Simon Thomson<a class="headerlink" href="#lecture-by-prof-simon-thomson" title="Permalink to this headline">¶</a></h2>
<p>Marlowe is a special-purpose language for writing financial contracts on Cardano.</p>
<div class="figure align-default">
<img alt="_images/pic__00005.png" src="_images/pic__00005.png" />
</div>
<div class="section" id="why-do-we-build-dsls">
<h3><span class="section-number">10.2.1. </span>Why do we build DSLs?<a class="headerlink" href="#why-do-we-build-dsls" title="Permalink to this headline">¶</a></h3>
<p>One reason is that we want to build languages that are closer to the language of the user and not so much the language of the system. They are
designed to be in the specific domain of the application. A financial language will talk about payments, for example.</p>
<p>When we write a DSL, we get some advantages. We can write down things in that domain, but we can’t perhaps write as much as we could in a general purpose language. And,
if we do work in this more specialised context, we have the advantage of being able to give people better feedback and better error messages. We can also give more
guarantees on program behaviour. That’s one of the things that will be stressed in this lecture.</p>
<div class="figure align-default">
<img alt="_images/pic__00006.png" src="_images/pic__00006.png" />
</div>
</div>
<div class="section" id="what-kind-of-assurance-can-we-give">
<h3><span class="section-number">10.2.2. </span>What kind of assurance can we give?<a class="headerlink" href="#what-kind-of-assurance-can-we-give" title="Permalink to this headline">¶</a></h3>
<p>We can give two kinds of assurance. We can make sure that contracts do what they are supposed to do, but we can also make sure that they don’t do what they shouldn’t. We
will see both aspects of that as we go along.</p>
<p>We’ve designed the language to be a simple as possible and the implementation reflects that, and we’ll talk a bit about that later on. Contracts are nice and readable, and also
we can easily simulate them, so we can present to users a very clear picture of how their contract in Marlowe will behave.</p>
<p>In fact, we can do more than that. Because they are particularly restricted, we can explore every possible behavior path that a contract can take, before it is executed. So, we
can give complete guarantees about how a contract will behave, not just on one or two tests, but on every possibly execution sequence.</p>
<p>It’s also more straightforward to write mathematical proofs of various kinds of safety, so that is the strongest criteria that we can hit in this kind of world; a mathematical
proof that the system will do certain things and won’t do others.</p>
</div>
<div class="section" id="what-does-a-financial-contract-do">
<h3><span class="section-number">10.2.3. </span>What does a financial contract do?<a class="headerlink" href="#what-does-a-financial-contract-do" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by looking at what a financial contract can do.</p>
<p>A contract can accept payments from participants in the contract.</p>
<p>Depending on choices made by one the participants, it can evolve in different directions.</p>
<div class="figure align-default">
<img alt="_images/pic__00011.png" src="_images/pic__00011.png" />
</div>
<p>It can make decisions based on external information such as the information coming from a stock exchange. So, information coming from an oracle can determine the future behaviour
of a contract.</p>
<p>A contract can also make payments out. If money has been deposited in the contract, that money can be deposited out to participants.</p>
<p>So we have flows of money and choices according to external factors.</p>
<p>One final thing that we have is that the roles in a contract are things that themselves can be owned. We represent that in Marlowe by minting tokens that
represent those roles. That means that we can use those tokens as evidence that somebody is meant to be playing a role. They are a form of security that a person
submitting a transaction is allowed to submit that transaction, but also it means that these roles are tradable. A role could be traded by another person or another contract.</p>
</div>
<div class="section" id="language-design">
<h3><span class="section-number">10.2.4. </span>Language design<a class="headerlink" href="#language-design" title="Permalink to this headline">¶</a></h3>
<p>Now let’s think about how to design a language based on these ingredients.</p>
<div class="figure align-default">
<img alt="_images/pic__00012.png" src="_images/pic__00012.png" />
</div>
<p>When we design a language of contracts, what we are really doing is designing a programming language. A smart contract is just a program running on a blockchain.</p>
<p>A contract could, in principle, run forever. And also, more subtly, it could get stuck waiting for an input forever.</p>
<p>It could terminate while holding assets, locking them up forever.</p>
<p>So there’s a whole lot of security issues that a program might have.</p>
<div class="section" id="designed-for-safety">
<h4><span class="section-number">10.2.4.1. </span>Designed for safety<a class="headerlink" href="#designed-for-safety" title="Permalink to this headline">¶</a></h4>
<p>What we chose to do was to design for safety.</p>
<div class="section" id="contracts-are-finite">
<h5><span class="section-number">10.2.4.1.1. </span>Contracts are finite<a class="headerlink" href="#contracts-are-finite" title="Permalink to this headline">¶</a></h5>
<p>Firstly, contracts are designed to be finite. Their life will be finite, there is no recursion or looping in Marlowe. We will come back to that a bit later on when
we talk about Marlowe being embedded in other languages.</p>
</div>
<div class="section" id="contracts-will-terminate">
<h5><span class="section-number">10.2.4.1.2. </span>Contracts will terminate<a class="headerlink" href="#contracts-will-terminate" title="Permalink to this headline">¶</a></h5>
<p>We can be sure that contracts will terminate. We do that by putting timeouts on every external action. Every choice, every deposit of money into the contract comes with
a deadline. Marlowe contracts cannot wait forever for somebody to make a choice or for an action to happen. If you hit the timeout then an alternative course is taken.</p>
</div>
<div class="section" id="no-assets-retained-on-close">
<h5><span class="section-number">10.2.4.1.3. </span>No assets retained on close<a class="headerlink" href="#no-assets-retained-on-close" title="Permalink to this headline">¶</a></h5>
<p>We’ve designed the semantics of the language so that when a contract reaches its close, at the end of its lifetime, any money left in the contract will be
refunded to participants.</p>
</div>
<div class="section" id="conservation-of-value">
<h5><span class="section-number">10.2.4.1.4. </span>Conservation of value<a class="headerlink" href="#conservation-of-value" title="Permalink to this headline">¶</a></h5>
<p>Conservation of value is something that we get for free from the underlying blockchain. The blockchain guarantees that we can’t double spend and because we are using
the transaction mechanisms of the underlying blockchain, we can be sure that we are getting conservation of value.</p>
<p>So this is giving us a lot of guarantees out of the box. These are not guarantees that you get from Plutus contracts in general. A Plutus contract could go on forever,
it need not terminate and it could terminate while holding a whole collection of assets which then become unreachable.</p>
</div>
</div>
</div>
<div class="section" id="the-marlowe-language">
<h3><span class="section-number">10.2.5. </span>The Marlowe Language<a class="headerlink" href="#the-marlowe-language" title="Permalink to this headline">¶</a></h3>
<p>So what does the language look like? Let’s cut to the chase.</p>
<div class="figure align-default">
<img alt="_images/pic__00013.png" src="_images/pic__00013.png" />
</div>
<p>Marlowe, at heart, is represented as a Haskell datatype.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">Contract</span> <span class="ow">=</span> <span class="kt">Close</span>
<span class="o">|</span> <span class="kt">Pay</span> <span class="kt">Party</span> <span class="kt">Payee</span> <span class="kt">Value</span> <span class="kt">Contract</span>
<span class="o">|</span> <span class="kt">If</span> <span class="kt">Observation</span> <span class="kt">Contract</span> <span class="kt">Contract</span>
<span class="o">|</span> <span class="kt">When</span> <span class="p">[</span><span class="kt">Case</span> <span class="kt">Action</span> <span class="kt">Contract</span><span class="p">]</span> <span class="kt">Timeout</span> <span class="kt">Contract</span>
<span class="o">|</span> <span class="kt">Let</span> <span class="kt">ValueId</span> <span class="kt">Value</span> <span class="kt">Contract</span>
<span class="o">|</span> <span class="kt">Assert</span> <span class="kt">Observation</span> <span class="kt">Contract</span>
<span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span><span class="kt">Ord</span><span class="p">,</span><span class="kt">Show</span><span class="p">,</span><span class="kt">Read</span><span class="p">,</span><span class="kt">Generic</span><span class="p">,</span><span class="kt">Pretty</span><span class="p">)</span>
</pre></div>
</div>
<p>We have a <em>Pay</em> construct. In that a <em>Party</em> in the contract makes a payment to a <em>Payee</em> of a particular <em>Value</em>, and then the contract continues with what we call the
continuation contract.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">Pay</span> <span class="kt">Party</span> <span class="kt">Payee</span> <span class="kt">Value</span> <span class="kt">Contract</span>
</pre></div>
</div>
<p>We can go in two separate directions. We can observe <em>If</em> a particular <em>Observation</em> is true or not. If the observation is true we follow the first <em>Contract</em>, if it is
false we follow the second <em>Contract</em>.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">If</span> <span class="kt">Observation</span> <span class="kt">Contract</span> <span class="kt">Contract</span>
</pre></div>
</div>
<p>The most complex construct in Marlowe is the <em>When</em> construct. It takes three arguments. The first of those is a list of <em>Contract</em>/<em>Action</em> pairs - a list of <em>Case</em>s.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">When</span> <span class="p">[</span><span class="kt">Case</span> <span class="kt">Action</span> <span class="kt">Contract</span><span class="p">]</span> <span class="kt">Timeout</span> <span class="kt">Contract</span>
</pre></div>
</div>
<p>What the <em>When</em> construct does is wait for one of a number of <em>Action</em>s. When one of those <em>Action</em>s happens, it performs the corresponding <em>Contract</em>. For example, it
could be waiting for a deposit. If we have a case where the first part of the pair is a deposit, then we execute the corresponding second part of the pair. Similarly with
making a choice or with getting a value from an oracle.</p>
<p>Here we are waiting for external actions and, of course, the contract can’t make those actions happen. A contract can’t force somebody to make a choice. It can’t force
somebody to make a deposit. But what we can do is say that if none of these actions takes place then we will hit the <em>Timeout</em>, and when we hit the <em>Timeout</em>, we will perform
the <em>Contract</em> represented by the final argument to the <em>When</em> construct.</p>
<p>So, we can guarantee that something will happen in the <em>When</em> construct, either by one of the actions triggering a successive contract, or we hit the timeout and go to that
continuation.</p>
<p>Finally we have the <em>Close</em> construct which has the semantics defined so that nothing is retained when we close.</p>
<p>That is the Marlowe language, and we will see that we can use these to construct Marlowe contracts in a variety of ways.</p>
</div>
<div class="section" id="the-marlowe-product">
<h3><span class="section-number">10.2.6. </span>The Marlowe Product<a class="headerlink" href="#the-marlowe-product" title="Permalink to this headline">¶</a></h3>
<p>So that is the language. What is the Marlowe product itself?</p>
<p>We have a suite of things. First we’ll look at the overall vision for Marlowe and then look at where we are in terms of fulfilling that vision.</p>
<div class="figure align-default">
<img alt="_images/pic__00014.png" src="_images/pic__00014.png" />
</div>
<p>… work in progress</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="week8.html" class="btn btn-neutral float-left" title="9. Week 08 - Property Based Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>