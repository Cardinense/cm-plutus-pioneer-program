

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2. Alonzo White Walkthrough &mdash; Plutus Pioneer Program Lecture Notes  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="1. Plutus Pioneer Program" href="plutus_pioneer_program.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Plutus Pioneer Program Lecture Notes
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="plutus_pioneer_program.html">1. Plutus Pioneer Program</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Alonzo White Walkthrough</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aws-node-setup">2.1. AWS Node Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-the-iohk-cache">2.1.1. Setup the IOHK Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-nix">2.1.2. Install Nix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-the-cardano-node">2.1.3. Download the Cardano Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-node">2.1.4. Build the node</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-the-node">2.1.5. Start the node</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-some-environment-variables">2.1.6. Setup some environment variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#some-helper-scripts">2.2. Some Helper Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-test-ada">2.3. Getting Test Ada</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generate-test-addresses">2.3.1. Generate test addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-the-faucet">2.3.2. Use the Faucet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transfer-some-funds">2.3.3. Transfer some funds</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alwayssucceeds-script">2.4. AlwaysSucceeds Script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pay-to-the-script">2.4.1. Pay to the Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unlock-the-funds-in-the-script">2.4.2. Unlock the Funds in the Script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alwaysfails-script">2.5. AlwaysFails Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#helloworld-script">2.6. HelloWorld Script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compiling-plutus-scripts">2.6.1. Compiling Plutus Scripts</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Plutus Pioneer Program Lecture Notes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Alonzo White Walkthrough</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/alonzowhiteex1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="alonzo-white-walkthrough">
<h1><span class="section-number">2. </span>Alonzo White Walkthrough<a class="headerlink" href="#alonzo-white-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>These are my notes taken while working through the Alonzo White exercises.</p>
<p>The notes take you through the process of setting up an AWS instance running an Alonzo White node, and using the command line to
move ADA between wallets and submit and executing smart contracts. It uses several helper scripts to simplify the creation of the commands. The helper scripts are
simple bash scripts that create <code class="docutils literal notranslate"><span class="pre">cardano-cli</span></code> commands and should be easy to understand to get a grip on what is going on behind the scenes.</p>
<p>This is the setup I chose to use, but there are several other ways to run the node and configure the environment.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The exercises are only possible if you have some test Ada from the Alonzo White faucet. Test Ada is currently only available to members
of the Alonzo test group in order to control usage of the network. Alonzo testnet is moving towards a public phase within a matter of weeks.</p>
</div>
<p>I started with a fresh <code class="docutils literal notranslate"><span class="pre">t2.large</span></code> AWS Ubuntu EC2 instance using AMI <code class="docutils literal notranslate"><span class="pre">ami-0ff4c8fb495a5a50d</span></code> and adding a 60Gb data volume.</p>
<div class="section" id="aws-node-setup">
<h2><span class="section-number">2.1. </span>AWS Node Setup<a class="headerlink" href="#aws-node-setup" title="Permalink to this headline">¶</a></h2>
<p>Mount the data volume.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkfs -t xfs /dev/xvdh
sudo mkdir /data
sudo mount /dev/xvdh /data
sudo chown ubuntu:ubuntu /data
</pre></div>
</div>
<div class="section" id="setup-the-iohk-cache">
<h3><span class="section-number">2.1.1. </span>Setup the IOHK Cache<a class="headerlink" href="#setup-the-iohk-cache" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /etc/nix
cat <span class="s">&lt;&lt;EOF | sudo tee /etc/nix/nix.conf</span>
<span class="s">substituters = https://cache.nixos.org https://hydra.iohk.io https://iohk.cachix.org</span>
<span class="s">trusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= hydra.iohk.io:f/Ea+s+dFdN+3Y/G+FDgSq+a5NEWhJGzdjvKNGv0/EQ= iohk.cachix.org-1:DpRUyj7h7V830dp/i6Nti+NEO2/nhblbov/8MW7Rqoo=</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="section" id="install-nix">
<h3><span class="section-number">2.1.2. </span>Install Nix<a class="headerlink" href="#install-nix" title="Permalink to this headline">¶</a></h3>
<p>We use a little trick here to let Nix use a symlinked directory. This is not recommended if you plan to have setups on multiple machines with potentially different configurations,
but that doesn’t matter here.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir /data/nix
sudo ln -s /data/nix /nix
<span class="nb">echo</span> <span class="s2">&quot;export NIX_IGNORE_SYMLINK_STORE=1&quot;</span> &gt;&gt; ~/.bashrc
<span class="nb">source</span> ~/.bashrc
curl -L https://nixos.org/nix/install <span class="p">|</span> sh
. /home/ubuntu/.nix-profile/etc/profile.d/nix.sh
</pre></div>
</div>
</div>
<div class="section" id="download-the-cardano-node">
<h3><span class="section-number">2.1.3. </span>Download the Cardano Node<a class="headerlink" href="#download-the-cardano-node" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data
git clone https://github.com/input-output-hk/cardano-node
<span class="nb">cd</span> cardano-node
git checkout tags/alonzo-white-1.1 -b alonzo_white_1_1
</pre></div>
</div>
</div>
<div class="section" id="build-the-node">
<h3><span class="section-number">2.1.4. </span>Build the node<a class="headerlink" href="#build-the-node" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nix-build -A scripts.alonzo-white.node -o result/alonzo-white/cardano-node-alonzo-white
nix-build -A cardano-cli -o result/alonzo-white/cardano-cli
</pre></div>
</div>
</div>
<div class="section" id="start-the-node">
<h3><span class="section-number">2.1.5. </span>Start the node<a class="headerlink" href="#start-the-node" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/cardano-node/result/alonzo-white
./cardano-node-alonzo-white/bin/cardano-node-alonzo-white
</pre></div>
</div>
<p>Leave this running and open another shell.</p>
</div>
<div class="section" id="setup-some-environment-variables">
<h3><span class="section-number">2.1.6. </span>Setup some environment variables<a class="headerlink" href="#setup-some-environment-variables" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;export CARDANO_CLI=/data/cardano-node/result/alonzo-white/cardano-cli/bin/cardano-cli&quot;</span> &gt;&gt; ~/.bashrc
<span class="nb">echo</span> <span class="s2">&quot;export TESTNET_MAGIC_NUM=7&quot;</span> &gt;&gt; ~/.bashrc
<span class="nb">echo</span> <span class="s2">&quot;export CARDANO_NODE_SOCKET_PATH=/data/cardano-node/result/alonzo-white/state-node-alonzo-white/node.socket&quot;</span> &gt;&gt; ~/.bashrc
<span class="nb">source</span> ~/.bashrc
</pre></div>
</div>
<p>You can check on the status of the node with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$CARDANO_CLI</span> query tip --testnet-magic <span class="nv">$TESTNET_MAGIC_NUM</span>
</pre></div>
</div>
<p>You should see something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
    <span class="s2">&quot;epoch&quot;</span>: <span class="m">60</span>,
    <span class="s2">&quot;hash&quot;</span>: <span class="s2">&quot;eb9453a91760928b286ea5137d6f9325f89f78b9c643f1e789c63c74b1934fa3&quot;</span>,
    <span class="s2">&quot;slot&quot;</span>: <span class="m">431693</span>,
    <span class="s2">&quot;block&quot;</span>: <span class="m">21187</span>,
    <span class="s2">&quot;era&quot;</span>: <span class="s2">&quot;Mary&quot;</span>,
    <span class="s2">&quot;syncProgress&quot;</span>: <span class="s2">&quot;19.01&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When the node has fully synced you will see that the era has changed to <code class="docutils literal notranslate"><span class="pre">Alonzo</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">289</span><span class="p">,</span>
    <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;7521f071d0bfc050cde302f1352ed44c2fc74927f1e28afea1b1df2c4c012d5c&quot;</span><span class="p">,</span>
    <span class="nt">&quot;slot&quot;</span><span class="p">:</span> <span class="mi">2079664</span><span class="p">,</span>
    <span class="nt">&quot;block&quot;</span><span class="p">:</span> <span class="mi">102026</span><span class="p">,</span>
    <span class="nt">&quot;era&quot;</span><span class="p">:</span> <span class="s2">&quot;Alonzo&quot;</span><span class="p">,</span>
    <span class="nt">&quot;syncProgress&quot;</span><span class="p">:</span> <span class="s2">&quot;100.00&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">jq</span></code> if you ever want to get some specific information on its own, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt update
sudo apt install jq -y

<span class="nv">$CARDANO_CLI</span> query tip --testnet-magic <span class="m">7</span> <span class="p">|</span> jq -r <span class="s1">&#39;.syncProgress&#39;</span>
<span class="m">100</span>.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="some-helper-scripts">
<h2><span class="section-number">2.2. </span>Some Helper Scripts<a class="headerlink" href="#some-helper-scripts" title="Permalink to this headline">¶</a></h2>
<p>I have a repo that contains a few helper scripts that I use. It’s rough and ready, but saves a little time for some common tasks.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data
git clone https://github.com/chris-moreton/plutus-scripts
</pre></div>
</div>
</div>
<div class="section" id="getting-test-ada">
<h2><span class="section-number">2.3. </span>Getting Test Ada<a class="headerlink" href="#getting-test-ada" title="Permalink to this headline">¶</a></h2>
<div class="section" id="generate-test-addresses">
<h3><span class="section-number">2.3.1. </span>Generate test addresses<a class="headerlink" href="#generate-test-addresses" title="Permalink to this headline">¶</a></h3>
<p>Run the generate wallets script to generate a few addresses.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/plutus-scripts
./generateAddresses.sh
</pre></div>
</div>
<p>This will create some <code class="docutils literal notranslate"><span class="pre">.addr</span></code>, <code class="docutils literal notranslate"><span class="pre">.skey</span></code> and <code class="docutils literal notranslate"><span class="pre">.vkey</span></code> files in the <code class="docutils literal notranslate"><span class="pre">wallets</span></code> directory.</p>
</div>
<div class="section" id="use-the-faucet">
<h3><span class="section-number">2.3.2. </span>Use the Faucet<a class="headerlink" href="#use-the-faucet" title="Permalink to this headline">¶</a></h3>
<p>If you have access to the testnet faucet, transfer some test Ada to the <code class="docutils literal notranslate"><span class="pre">main</span></code> wallet.</p>
<p>Then, check that it has arrived. It should arrive within a minute or so.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/plutus-scripts
./balance.sh main

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
40f0fa60a71e247e3eca46147fc159080aa7667763ae8c3be00b2e48400bbccd     <span class="m">0</span>        <span class="m">1000000000000</span> lovelace + TxOutDatumHashNone
</pre></div>
</div>
</div>
<div class="section" id="transfer-some-funds">
<h3><span class="section-number">2.3.3. </span>Transfer some funds<a class="headerlink" href="#transfer-some-funds" title="Permalink to this headline">¶</a></h3>
<p>We will transfer some funds to <code class="docutils literal notranslate"><span class="pre">wallet1</span></code>. This uses another helper script, which takes the sending wallet as an argument and then asks for the UTxO, amount and receiving wallet name.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sendFromWallet.sh main

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
40f0fa60a71e247e3eca46147fc159080aa7667763ae8c3be00b2e48400bbccd     <span class="m">0</span>        <span class="m">1000000000000</span> lovelace + TxOutDatumHashNone

TX row number: <span class="m">1</span>
Lovelace to send: <span class="m">1000000000</span>
Receiving wallet name: wallet1

Transaction successfully submitted.
</pre></div>
</div>
<p>Check that it has arrived.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./balance.sh wallet1

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
bd7422ef2cd55d1c5a33601a3b75b080bc3742856e5ddb8dfdfae07f583c7af1     <span class="m">0</span>        <span class="m">1000000000</span> lovelace + TxOutDatumHashNone
</pre></div>
</div>
</div>
</div>
<div class="section" id="alwayssucceeds-script">
<h2><span class="section-number">2.4. </span>AlwaysSucceeds Script<a class="headerlink" href="#alwayssucceeds-script" title="Permalink to this headline">¶</a></h2>
<p>Plutus scripts get compiled down to the following format.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;PlutusScriptV1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cborHex&quot;</span><span class="p">:</span> <span class="s2">&quot;585c585a010000332233322233333322222233222220051200120012122222300500622122222330040070062122222300300621222223002006212222230010062001112200212212233001004003120011122123300100300211200101&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is the <code class="docutils literal notranslate"><span class="pre">AlwaysSuccess.plutus</span></code> script whose validator always succeeds, which means that anyone will be able to consume any UTxO sitting at its address. The script can be found in the <code class="docutils literal notranslate"><span class="pre">/data/plutus-scripts/scripts</span></code> directory.</p>
<div class="section" id="pay-to-the-script">
<h3><span class="section-number">2.4.1. </span>Pay to the Script<a class="headerlink" href="#pay-to-the-script" title="Permalink to this headline">¶</a></h3>
<p>Using the <code class="docutils literal notranslate"><span class="pre">payToScript.sh</span></code> helper script, you can send <code class="docutils literal notranslate"><span class="pre">99000000</span></code> lovelace from <code class="docutils literal notranslate"><span class="pre">wallet</span></code> to the <code class="docutils literal notranslate"><span class="pre">AlwaysSucceeds.plutus</span></code> script with a datum of <code class="docutils literal notranslate"><span class="pre">6666</span></code>, allowing for fees of <code class="docutils literal notranslate"><span class="pre">200000</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./payToScript.sh <span class="m">99000000</span> <span class="m">200000</span> AlwaysSucceeds <span class="m">6666</span> wallet1

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
bd7422ef2cd55d1c5a33601a3b75b080bc3742856e5ddb8dfdfae07f583c7af1     <span class="m">0</span>        <span class="m">1000000000</span> lovelace + TxOutDatumHashNone
TX row number: <span class="m">1</span>
Transaction successfully submitted.
</pre></div>
</div>
<p>Check that the funds arrive in the script using the <code class="docutils literal notranslate"><span class="pre">contractBalance.sh</span></code> script. You may see a lot of UTxOs sitting at the <code class="docutils literal notranslate"><span class="pre">AlwaysSucceeds</span></code> script address and hopefully
one of them will be yours.</p>
<p>The UTxOs at this address are now <em>locked</em> in the sense that they are guarded by a validator. The script address is the hash of the validator.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./contractBalance.sh AlwaysSucceeds

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
063a62b69e51296417687077f8df67f1b2fe1568830ad56fb0f04d22739e69e2     <span class="m">0</span>        <span class="m">5000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;b7a4cc0f36854309590c132e75dad06a4f6045e57ac93e6dafc9bf0d0018247d&quot;</span>
44412566ec42af806660fe9846a71b50eae1b7028116a3d666cab3ba1f02d7ee     <span class="m">0</span>        <span class="m">1000000000000</span> lovelace + TxOutDatumHashNone
56382a3e1789df882114b2322787f1785eac71b19675ee88fd1dc6ca807ddc02     <span class="m">0</span>        <span class="m">999888777</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
843f4ffa4aafc5ed968d0a9f0fb8a203796b66327343246bfd8d4ca1d361c2f8     <span class="m">0</span>        <span class="m">99000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
8657ff66828f90ab7d45fb2e9f10286d9887f49bc83f7cf3d7b45e8fd1068aaf     <span class="m">0</span>        <span class="m">10000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e1199a988ba72ffd6e9c269cadb3b53b5f360ff99f112d9b2ee30c4d74ad88b&quot;</span>
8c5f24a4eee17773d2ddef2ee1493248b1c45c56e6851d6f330deee1dc23a21f     <span class="m">0</span>        <span class="m">1010011010</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;915e807fa63409181d1533195753e3170587b1edc089be670ab483da8f9bcd48&quot;</span>
8f75351368cc2521315ac9908f0532a00e996e35644cbd9db4d616a7122c7491     <span class="m">0</span>        <span class="m">979199655182</span> lovelace + TxOutDatumHashNone
f441da5a5f04ee6057a98650bf4c2a4931906e37acfd2d705cb208eda48cef92     <span class="m">0</span>        <span class="m">10000000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;df5078aee07dd171a343fb99d5fc1b5462fb3c94d82bf72dc1b77d9c0aceec29&quot;</span>
</pre></div>
</div>
<p>In this case, the balance of UTxO number 4 is <code class="docutils literal notranslate"><span class="pre">99000000</span></code> and the datum hash is <code class="docutils literal notranslate"><span class="pre">9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710</span></code>. We can check that this is the
correct datum hash.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$CARDANO_CLI</span> transaction hash-script-data --script-data-value <span class="m">6666</span>
9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710
</pre></div>
</div>
<p>If there are too many, you could use <code class="docutils literal notranslate"><span class="pre">grep</span></code> to filter out the ones with the correct balance.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./contractBalance.sh AlwaysSucceeds <span class="p">|</span> grep <span class="m">99000000</span>
843f4ffa4aafc5ed968d0a9f0fb8a203796b66327343246bfd8d4ca1d361c2f8     <span class="m">0</span>        <span class="m">99000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="unlock-the-funds-in-the-script">
<h3><span class="section-number">2.4.2. </span>Unlock the Funds in the Script<a class="headerlink" href="#unlock-the-funds-in-the-script" title="Permalink to this headline">¶</a></h3>
<p>When trying to consume UTxOs locked in a script, you need to provide collateral that will cover the costs if validation fails. For this we can use a separate wallet for storing
collateral UTxOs, to keep things tidy. One of the several wallets we created earlier on was named <code class="docutils literal notranslate"><span class="pre">fees</span></code>.</p>
<p>Under normal circumstances, collateral should never be lost because the wallet can perform validation in a deterministic fashion and only
submit the transaction if validation is guaranteed to pass.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./sendFromWallet.sh main

                        TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
bd7422ef2cd55d1c5a33601a3b75b080bc3742856e5ddb8dfdfae07f583c7af1     <span class="m">1</span>        <span class="m">998999800000</span> lovelace + TxOutDatumHashNone
TX row number: <span class="m">1</span>
Lovelace to send: <span class="m">1000000000</span>
Receiving wallet name: fees
Transaction successfully submitted.
</pre></div>
</div>
<p>We should check that it’s arrived in our <code class="docutils literal notranslate"><span class="pre">fees</span></code> wallet.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./balance.sh fees
                        TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
7678d8d6b95ed026d7c690fb53419bdaa580cb00c56450ac3bd97712dd71ca4e     <span class="m">0</span>        <span class="m">1000000000</span> lovelace + TxOutDatumHashNone
</pre></div>
</div>
<p>The following command will try to get 1000000 lovelace from the script using fees of <code class="docutils literal notranslate"><span class="pre">100000000</span></code> and a datum of <code class="docutils literal notranslate"><span class="pre">6666</span></code>, which is the correct datum.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./getFromScript.sh <span class="m">1000000</span> <span class="m">100000000</span> AlwaysSucceeds <span class="nv">6666</span>
<span class="o">============================================================================================</span>
Select Script <span class="nv">UTxO</span>
<span class="o">============================================================================================</span>
TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
063a62b69e51296417687077f8df67f1b2fe1568830ad56fb0f04d22739e69e2     <span class="m">0</span>        <span class="m">5000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;b7a4cc0f36854309590c132e75dad06a4f6045e57ac93e6dafc9bf0d0018247d&quot;</span>
44412566ec42af806660fe9846a71b50eae1b7028116a3d666cab3ba1f02d7ee     <span class="m">0</span>        <span class="m">1000000000000</span> lovelace + TxOutDatumHashNone
56382a3e1789df882114b2322787f1785eac71b19675ee88fd1dc6ca807ddc02     <span class="m">0</span>        <span class="m">999888777</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
843f4ffa4aafc5ed968d0a9f0fb8a203796b66327343246bfd8d4ca1d361c2f8     <span class="m">0</span>        <span class="m">99000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
8657ff66828f90ab7d45fb2e9f10286d9887f49bc83f7cf3d7b45e8fd1068aaf     <span class="m">0</span>        <span class="m">10000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e1199a988ba72ffd6e9c269cadb3b53b5f360ff99f112d9b2ee30c4d74ad88b&quot;</span>
8c5f24a4eee17773d2ddef2ee1493248b1c45c56e6851d6f330deee1dc23a21f     <span class="m">0</span>        <span class="m">1010011010</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;915e807fa63409181d1533195753e3170587b1edc089be670ab483da8f9bcd48&quot;</span>
8f75351368cc2521315ac9908f0532a00e996e35644cbd9db4d616a7122c7491     <span class="m">0</span>        <span class="m">979199655182</span> lovelace + TxOutDatumHashNone
f441da5a5f04ee6057a98650bf4c2a4931906e37acfd2d705cb208eda48cef92     <span class="m">0</span>        <span class="m">10000000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;df5078aee07dd171a343fb99d5fc1b5462fb3c94d82bf72dc1b77d9c0aceec29&quot;</span>

TX row number: <span class="nv">4</span>
<span class="o">============================================================================================</span>
Select Collateral <span class="nv">UTxO</span>
<span class="o">============================================================================================</span>
Wallet Name: fees
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
7678d8d6b95ed026d7c690fb53419bdaa580cb00c56450ac3bd97712dd71ca4e     <span class="m">0</span>        <span class="m">1000000000</span> lovelace + TxOutDatumHashNone
TX row number: <span class="m">1</span>
Receiving Wallet: wallet2

Command failed: transaction submit  Error: Error <span class="k">while</span> submitting tx: ShelleyTxValidationError ShelleyBasedEraAlonzo <span class="o">(</span>ApplyTxError <span class="o">[</span>UtxowFailure <span class="o">(</span>WrappedShelleyEraFailure <span class="o">(</span>UtxoFailure <span class="o">(</span>FeeTooSmallUTxO <span class="o">(</span>Coin <span class="m">110180197</span><span class="o">)</span> <span class="o">(</span>Coin <span class="m">100000000</span><span class="o">))))])</span>
</pre></div>
</div>
<p>Here the transaction has failed because the fees were too low. It tells us what the fees should be, so we can try again with.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./getFromScript.sh <span class="m">1000000</span> <span class="m">110180197</span> AlwaysSucceeds <span class="m">6666</span>
...
Transaction successfully submitted.
</pre></div>
</div>
<p>Let’s check that it arrived in <code class="docutils literal notranslate"><span class="pre">wallet2</span></code> as expected.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./balance.sh wallet2

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
ee22529028220bb2d2cbda634fbe982602afd5baf7f173341e2c8f9157e2912d     <span class="m">1</span>        <span class="m">1000000</span> lovelace + TxOutDatumHashNone
</pre></div>
</div>
<p>We have managed to extract 1,000,000 lovelace from the contract.</p>
<p>Let’s try it with an invalid datum.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./getFromScript.sh <span class="m">1000000</span> <span class="m">110180197</span> AlwaysSucceeds <span class="m">5555</span>
...
Command failed: transaction submit  Error: Error <span class="k">while</span> submitting tx: ShelleyTxValidationError ShelleyBasedEraAlonzo <span class="o">(</span>ApplyTxError <span class="o">[</span>UtxowFailure <span class="o">(</span>MissingRequiredDatums <span class="o">(</span>fromList <span class="o">[</span>SafeHash <span class="s2">&quot;9e1199a988ba72ffd6e9c269cadb3b53b5f360ff99f112d9b2ee30c4d74ad88b&quot;</span><span class="o">])</span> <span class="o">(</span>fromList <span class="o">[</span>SafeHash <span class="s2">&quot;71f5a96d948593ef12667c22d49b5dbbed7f00c7a3e88083cdf7391c5cc3ba73&quot;</span><span class="o">]))])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="alwaysfails-script">
<h2><span class="section-number">2.5. </span>AlwaysFails Script<a class="headerlink" href="#alwaysfails-script" title="Permalink to this headline">¶</a></h2>
<p>Now we will try similar transactions with a script whose validator always fails. This time we will lose our collateral.</p>
<p>First, lock some lovelace in the AlwaysFails script which will be picked up from the <code class="docutils literal notranslate"><span class="pre">./scripts</span></code> directory of the cloned <code class="docutils literal notranslate"><span class="pre">plutus-scripts</span></code> repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./payToScript.sh <span class="m">99000000</span> <span class="m">200000</span> AlwaysFails <span class="m">6666</span> wallet1

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
843f4ffa4aafc5ed968d0a9f0fb8a203796b66327343246bfd8d4ca1d361c2f8     <span class="m">1</span>        <span class="m">900800000</span> lovelace + TxOutDatumHashNone
TX row number: <span class="m">1</span>
Transaction successfully submitted.
</pre></div>
</div>
<p>Check that it has arrived.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./contractBalance.sh AlwaysFails

TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
0913d72c55b3d6e765eb51f1a5da1436ea0554a89d499fe3398d20517f0b455e     <span class="m">0</span>        <span class="m">99000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
29f82f40603c4328e6efffb7c6e8851fe9540d18ddc0930b188896f6b016e141     <span class="m">0</span>        <span class="m">100000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;ee5c9e2778c6c398366c5b9cfd67a888081f7626ca0ac392faca5981e59ff759&quot;</span>
5589e823cf148597cbf64dc7cb5ebcd3957d5fc83c3521b281daa9f9c490c8ab     <span class="m">0</span>        <span class="m">999888777</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
</pre></div>
</div>
<p>Now we try to get some funds from the script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./getFromScript.sh <span class="m">1000000</span> <span class="m">110180417</span> AlwaysFails <span class="nv">6666</span>
<span class="o">============================================================================================</span>
Select Script <span class="nv">UTxO</span>
<span class="o">============================================================================================</span>
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
0913d72c55b3d6e765eb51f1a5da1436ea0554a89d499fe3398d20517f0b455e     <span class="m">0</span>        <span class="m">99000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
29f82f40603c4328e6efffb7c6e8851fe9540d18ddc0930b188896f6b016e141     <span class="m">0</span>        <span class="m">100000000</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;ee5c9e2778c6c398366c5b9cfd67a888081f7626ca0ac392faca5981e59ff759&quot;</span>
5589e823cf148597cbf64dc7cb5ebcd3957d5fc83c3521b281daa9f9c490c8ab     <span class="m">0</span>        <span class="m">999888777</span> lovelace + TxOutDatumHash ScriptDataInAlonzoEra <span class="s2">&quot;9e478573ab81ea7a8e31891ce0648b81229f408d596a3483e6f4f9b92d3cf710&quot;</span>
TX row number: <span class="nv">1</span>
<span class="o">============================================================================================</span>
Select Collateral <span class="nv">UTxO</span>
<span class="o">============================================================================================</span>
Wallet Name: fees
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
ee22529028220bb2d2cbda634fbe982602afd5baf7f173341e2c8f9157e2912d     <span class="m">0</span>        <span class="m">889819803</span> lovelace + TxOutDatumHashNone
TX row number: <span class="m">1</span>
Receiving Wallet: wallet2
Transaction successfully submitted.
</pre></div>
</div>
<p>But will we now find that the collateral has gone. The validation failed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./balance.sh fees
TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
</pre></div>
</div>
<p>And the funds will never arrive. We still have just one UTxO, the one we got from the <code class="docutils literal notranslate"><span class="pre">AlwaysSucceeds</span></code> script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./balance.sh wallet2
                       TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
ee22529028220bb2d2cbda634fbe982602afd5baf7f173341e2c8f9157e2912d     <span class="m">1</span>        <span class="m">1000000</span> lovelace + TxOutDatumHashNone
</pre></div>
</div>
</div>
<div class="section" id="helloworld-script">
<h2><span class="section-number">2.6. </span>HelloWorld Script<a class="headerlink" href="#helloworld-script" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compiling-plutus-scripts">
<h3><span class="section-number">2.6.1. </span>Compiling Plutus Scripts<a class="headerlink" href="#compiling-plutus-scripts" title="Permalink to this headline">¶</a></h3>
<p>First, we need to go into a Nix shell. The shell from <code class="docutils literal notranslate"><span class="pre">cardano-node</span></code> doesn’t work for me, so I cloned the <code class="docutils literal notranslate"><span class="pre">plutus</span></code> repository and used its shell instead.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data
git clone https://github.com/input-output-hk/plutus
<span class="nb">cd</span> plutus
nix-shell
</pre></div>
</div>
<p>Now, we can change to the <code class="docutils literal notranslate"><span class="pre">plutus-helloworld</span></code> directory and run the code.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/plutus-scripts/plutus-sources/plutus-helloworld
</pre></div>
</div>
<p>If you look in the <code class="docutils literal notranslate"><span class="pre">plutus-helloworld.cabal</span></code> file in, you’ll find some executables defined, one of which is called <code class="docutils literal notranslate"><span class="pre">plutus-helloworld</span></code>.</p>
<p>Running this executable will create compiled Plutus code as output.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cabal update
cabal run plutus-helloworld
</pre></div>
</div>
<p>This outputs, among other things, something like the following.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ExBudget <span class="o">{</span><span class="nv">_exBudgetCPU</span> <span class="o">=</span> ExCPU <span class="m">9814000</span>, <span class="nv">_exBudgetMemory</span> <span class="o">=</span> ExMemory <span class="m">2260</span><span class="o">}</span>
</pre></div>
</div>
<p>These value represent the expected CPU and memory usage required to run the script. Fees for running scripts are calculated using these values.</p>
<p>It also outputs a file called <code class="docutils literal notranslate"><span class="pre">result.plutus</span></code>, which contains the compiled Plutus code.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;PlutusScriptV1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cborHex&quot;</span><span class="p">:</span> <span class="s2">&quot;5902355902320100003232323332223322333222323232323322333333222222323232323232222333530163335006300812001003300412001201b23500601b01a2300a4830af38f1ab6649049848004d400888004d400488008d55540584888cc00c888ccccd4c01c0088cccccd4c02000888cc04c00c0088880608805c8805c8805c06088cccccd4c02400c88060888ccd4c060cc05001400c8ccd4c05c48004c02c4800401400c80680708806088060880600648cccccd4c0200088805c88806088cc04800c0088805c8805c0608cccccd4c0200088805c8880608805c88ccd4c05048004c0204800400c0088805c0608cccccd4c0200088805c8880608805c8805c88ccd4c0504800401c00c00806088d4d5403000888d4d5403800c88ccd4c058ccc020480040100088ccc0244800401000880600688488888c01401888488888cc01001c0188488888c00c0188488888c0080188488888c0040188004448848cc00400c00844800488c8ccd5ea00201201066e9002001223233357a80080400399bc0008004d4004800448c004d54028884888ccd4d40300088ccd4d4034008802c888030030888ccd4d403c0108030888ccd4c034cc02401800c8ccd4c0304800402801800c803c04403802c48800848800480044800480044488008488488cc00401000c48004448c8c00400488cc00cc8c00400400800444448cd4008848cc0048d400c88c00800c8d400c88c00400c00448c8c8c00400488cc00cc8c0040040080048848d4c01048d4c01000cd400c0040041&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now move this script to our <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory and give it a more useful name.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mv result.plutus ../../scripts/HelloWorld.plutus
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plutus_pioneer_program.html" class="btn btn-neutral float-left" title="1. Plutus Pioneer Program" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>